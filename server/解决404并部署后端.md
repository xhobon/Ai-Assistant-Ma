# 为什么是 404？如何正确部署后端

## nextjs-boilerplate-ctzc.vercel.app 显示 404 的原因

该 Vercel 项目当前部署的是 **Next.js 模板**（例如 “Initial commit” 的 nextjs-boilerplate），不是本仓库里的 **Express 后端**（`server/`）。  
Next.js 项目没有 `/health`、`/api/assistant/chat` 等接口，所以访问会得到 **404 NOT_FOUND**。  
要让 Mac App 的对话/翻译可用，需要把 **`server/` 单独部署成一个新的 Vercel 项目**（见下方步骤），得到专用的 API 域名。

---

## 为什么 “nextjs-boilerplate” 类地址会 404？

该类地址对应的是 **Next.js 前端项目**。那种项目只提供前端页面路由，没有我们当前的 **Express 后端 API**（`server/` 里的对话、翻译、登录等接口）。

所以：
- 访问根路径 `/` 或前端未定义的路径 → 会返回 Next.js 的 “This page could not be found” (404)
- 我们的后端需要**单独**作为一个 Vercel 项目部署，会得到**另一个**域名，专门用来提供 API。

---

## 正确做法：把 `server/` 单独部署成一个新 Vercel 项目

### 1. 用 Vercel CLI 从本机部署（推荐）

在终端执行（把 `server` 目录作为根目录部署）：

```bash
cd /Users/akun/Desktop/Ai助理Mac/Ai助理Mac/server
npx vercel login
npx vercel
```

按提示操作：
- 若问 “Link to existing project?” 选 **N**（不关联已有项目）
- 若问 “Project name?” 可填 `ai-assistant-api` 或任意名称
- 部署完成后会给出一个地址，例如：`https://ai-assistant-api-xxx.vercel.app`

### 2. 在 Vercel 网页里用 “Import” 部署

1. 打开 [vercel.com](https://vercel.com) → **Add New** → **Project**
2. 选择 “Import Git Repository”（你的仓库要包含 `server` 目录）
3. 在 **Root Directory** 里点 **Edit**，填：`server`
4. 确认后 **Deploy**
5. 部署完成后会得到该项目的域名，例如：`https://你的项目名.vercel.app`

### 3. 配置环境变量（必做）

在新项目的 **Settings** → **Environment Variables** 里添加：

- `GROQ_API_KEY`：你的 Groq API Key（[Groq Console](https://console.groq.com/)）
- `JWT_SECRET`：任意随机长字符串（用于登录 Token）
- `DATABASE_URL`：若用到数据库，填 PostgreSQL 连接串（可选，无数据库时部分功能不可用）

保存后在该项目的 **Deployments** 里点 **Redeploy**，让环境变量生效。

### 4. 验证后端是否正常

在浏览器访问（把域名换成你新项目得到的）：

- `https://你的新后端域名.vercel.app/health`

应返回类似：`{"status":"ok","time":"..."}`

### 5. 在 Mac App 里使用新地址

把 App 里的「API 基础地址」改成上面这个**新后端域名**（不要用 `nextjs-boilerplate-pi-one-a27xruobcp.vercel.app`）。

若 App 里没有可配置项，需要改代码里的默认地址：在 `AppServices.swift` 中把 `builtInProductionURL` 改成你的新后端 URL（例如 `https://ai-assistant-api-xxx.vercel.app`）。

---

## 总结

| 地址 | 用途 |
|------|------|
| `nextjs-boilerplate-pi-one-a27xruobcp.vercel.app` | Next.js 前端项目 → 访问未定义路由会 404 |
| **新部署的 `server` 项目**（如 `ai-assistant-api-xxx.vercel.app`） | 后端 API → 对话、翻译、登录等，Mac App 应连这里 |

按上面步骤把 `server/` 部署成新项目并配置好 `GROQ_API_KEY` 后，再用新域名在 App 里请求，404 就会消失，智能体即可正常使用。
